C251 COMPILER V5.60.0,  drv8701_dual                                                       20/11/24  20:41:05  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE drv8701_dual
OBJECT MODULE PLACED IN .\Out_File\drv8701_dual.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\CODE\UserLibraries\drv8701_dual.c XSMALL WARNINGLEVEL(3) OPTIMIZE(0
                    -,SPEED) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;.
                    -.\CODE;..\USER\inc;..\USER\src;..\..\Libraries\seekfree_components;..\CODE\UserLibraries;..\CODE\Algorithms) DEBUG PRINT
                    -(.\Out_File\drv8701_dual.lst) TABS(2) OBJECT(.\Out_File\drv8701_dual.obj) 

stmt  level    source

    1          /*********************
    2           * drv8701_dual.c
    3           * 
    4           * 作者: COTOMO
    5           * 项目地址: https://github.com/Eclipse-01/SmartVehicleSchool
    6           * MIT开源证书
    7           * JNU-FLY at Jiangnan University
    8           * 2024 November
    9           * 
   10           * 本文件实现了DRV8701双电机驱动的初始化、控制和停止功能。
   11           ********************************************************************************************************
             -************/
   12          
   13          #include "drv8701_dual.h"
   14          #include "headfile.h"
   15          
   16          // 更新为与示例代码一致的引脚定义
   17          #define PWM_1  PWMA_CH4P_P26   // 电机1 PWM通道
   18          #define PWM_2  PWMA_CH2N_P13   // 电机2 PWM通道
   19          
   20          #define DIR_1 P24    // 电机1方向控制引脚
   21          #define DIR_2 P10    // 电机2方向控制引脚
   22              
   23          /**
   24           * @brief 初始化DRV8701电机驱动，包括PWM和GPIO的初始化
   25           */
   26          void drv8701_init(void)
   27          {
   28   1          // 初始化PWM通道，使用17kHz频率，占空比为0
   29   1          pwm_init(PWM_1, 17000, 0);
   30   1          pwm_init(PWM_2, 17000, 0);
   31   1      
   32   1          // 初始化方向控制引脚为推挽输出模式
   33   1          gpio_mode(DIR_1, GPO_PP);
   34   1          gpio_mode(DIR_2, GPO_PP);
   35   1      }
   36          
   37          /**
   38           * @brief 控制DRV8701电机的方向和速度
   39           * @param motor_select 电机选择，MOTOR_L、MOTOR_R 或 MOTOR_BOTH
   40           * @param speed 速度值，范围-100到100
   41           */
   42          void drv8701_control(Motor_Select motor_select, int32 speed)//speed范围-100到100
   43          {
   44   1          if (speed > 100) // 限制速度范围
   45   1          {
   46   2              speed = 100;
   47   2          }
   48   1          else if (speed < -100)
   49   1          {
   50   2              speed = -100;
   51   2          }
   52   1          speed = ((speed * PWM_DUTY_MAX) / 200); // 将速度值转换为PWM占空比
   53   1          if (motor_select == MOTOR_L || motor_select == MOTOR_BOTH)//控制左边舵机
   54   1          {
   55   2              if (speed >= 0)
C251 COMPILER V5.60.0,  drv8701_dual                                                       20/11/24  20:41:05  PAGE 2   

   56   2              {
   57   3                  DIR_1 = 1;
   58   3                  pwm_duty(PWM_1, speed);
   59   3              }
   60   2              else
   61   2              {
   62   3                  DIR_1 = 0;
   63   3                  pwm_duty(PWM_1, -speed);
   64   3              }
   65   2          }
   66   1          if (motor_select == MOTOR_R || motor_select == MOTOR_BOTH)//控制右边舵机
   67   1          {
   68   2              if (speed >= 0)
   69   2              {
   70   3                  DIR_2 = 1;
   71   3                  pwm_duty(PWM_2, speed);
   72   3              }
   73   2              else
   74   2              {
   75   3                  DIR_2 = 0;
   76   3                  pwm_duty(PWM_2, -speed);
   77   3              }
   78   2          }
   79   1      }
   80          
   81          /**
   82           * @brief 停止DRV8701电机
   83           * @param motor_select 电机选择，MOTOR_L、MOTOR_R 或 MOTOR_BOTH
   84           */
   85          void drv8701_stop(Motor_Select motor_select)
   86          {
   87   1          if (motor_select == MOTOR_L || motor_select == MOTOR_BOTH)
   88   1          {
   89   2              pwm_duty(PWM_1, 0);
   90   2          }
   91   1      
   92   1          if (motor_select == MOTOR_R || motor_select == MOTOR_BOTH)
   93   1          {
   94   2              pwm_duty(PWM_2, 0);
   95   2          }
   96   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       345     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =         8     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
