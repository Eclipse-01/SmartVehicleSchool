C251 COMPILER V5.60.0,  drv8701_dual                                                       26/11/24  16:35:21  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE drv8701_dual
OBJECT MODULE PLACED IN .\Out_File\drv8701_dual.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\CODE\UserLibraries\drv8701_dual.c XSMALL WARNINGLEVEL(3) OPTIMIZE(0
                    -,SPEED) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;.
                    -.\CODE;..\USER\inc;..\USER\src;..\..\Libraries\seekfree_components;..\CODE\UserLibraries;..\CODE\Algorithms) DEBUG PRINT
                    -(.\Out_File\drv8701_dual.lst) TABS(2) OBJECT(.\Out_File\drv8701_dual.obj) 

stmt  level    source

    1          /*********************
    2           * drv8701_dual.c
    3           * 
    4           * 作者: COTOMO
    5           * 项目地址: https://github.com/Eclipse-01/SmartVehicleSchool
    6           * MIT开源证书
    7           * JNU-FLY at Jiangnan University
    8           * 2024 November
    9           * 
   10           * 本文件实现了DRV8701双电机驱动的初始化、控制和停止功能。
   11           ********************************************************************************************************
             -************/
   12          
   13          #include "drv8701_dual.h"
   14          #include "headfile.h"
   15          
   16          // 更新为与示例代码一致的引脚定义
   17          #define PWM_1  PWMA_CH4P_P26   // 电机1 PWM通道
   18          #define PWM_2  PWMA_CH2N_P13   // 电机2 PWM通道
   19          
   20          #define DIR_1 P24    // 电机1方向控制引脚
   21          #define DIR_2 P10    // 电机2方向控制引脚
   22              
   23          /**
   24           * @brief 初始化DRV8701电机驱动，包括PWM和GPIO的初始化
   25           */
   26          void drv8701_init(void)
   27          {
   28   1          // 初始化PWM通道，使用17kHz频率，占空比为0
   29   1          pwm_init(PWM_1, 17000, 0);
   30   1          pwm_init(PWM_2, 17000, 0);
   31   1      
   32   1          // 初始化方向控制引脚为推挽输出模式
   33   1        gpio_mode(P1_0, GPO_PP);  // P10引脚设置为推挽输出
   34   1        gpio_mode(P2_4, GPO_PP);  // P24引脚设置为推挽输出
   35   1      }
   36          
   37          /**
   38           * @brief 控制DRV8701电机的方向和速度
   39           * @param motor_select 电机选择，MOTOR_L、MOTOR_R 或 MOTOR_BOTH
   40           * @param speed 速度值，范围-100到100
   41           */
   42          void drv8701_control(Motor_Select motor_select, int32 speed)//speed范围-100到100
   43          {
   44   1          int dir = speed > 0 ? 1 : 0;//若速度大于0，speed_sign为1，否则为0
   45   1          speed = abs(speed);//取绝对值
*** WARNING C188 IN LINE 45 OF ..\CODE\UserLibraries\drv8701_dual.c: 'parameter 1': value truncated
   46   1          if (speed > 100) // 限制速度范围
   47   1          {
   48   2              speed = 100;
   49   2          }
   50   1          speed = ((speed * PWM_DUTY_MAX) / 200); // 将速度值转换为PWM占空比
   51   1          if (motor_select == MOTOR_L || motor_select == MOTOR_BOTH)//控制左边舵机
   52   1          {
   53   2              if (dir)
   54   2              {
C251 COMPILER V5.60.0,  drv8701_dual                                                       26/11/24  16:35:21  PAGE 2   

   55   3                  DIR_1 = 0;
   56   3                  pwm_duty(PWM_1, speed);
   57   3              }
   58   2              else
   59   2              {
   60   3                  DIR_1 = 1;
   61   3                  pwm_duty(PWM_1, speed);
   62   3              }
   63   2          }
   64   1          if (motor_select == MOTOR_R || motor_select == MOTOR_BOTH)//控制右边舵机
   65   1          {
   66   2              if (dir)
   67   2              {
   68   3                  DIR_2 = 1;
   69   3                  pwm_duty(PWM_2, speed);
   70   3              }
   71   2              else
   72   2              {
   73   3                  DIR_2 = 0;
   74   3                  pwm_duty(PWM_2, speed);
   75   3              }
   76   2          }
   77   1      }
   78          
   79          /**
   80           * @brief 停止DRV8701电机
   81           * @param motor_select 电机选择，MOTOR_L、MOTOR_R 或 MOTOR_BOTH
   82           */
   83          void drv8701_stop(Motor_Select motor_select)
   84          {
   85   1          if (motor_select == MOTOR_L || motor_select == MOTOR_BOTH)
   86   1          {
   87   2              pwm_duty(PWM_1, 0);
   88   2          }
   89   1      
   90   1          if (motor_select == MOTOR_R || motor_select == MOTOR_BOTH)
   91   1          {
   92   2              pwm_duty(PWM_2, 0);
   93   2          }
   94   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       334     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        10     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
