C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE SEEKFREE_IMU963RA
OBJECT MODULE PLACED IN .\Out_File\SEEKFREE_IMU963RA.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\..\Libraries\seekfree_peripheral\SEEKFREE_IMU963RA.c XSMALL WARNING
                    -LEVEL(3) OPTIMIZE(0,SPEED) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\se
                    -ekfree_peripheral;..\CODE;..\USER\inc;..\USER\src;..\..\Libraries\seekfree_components;..\CODE\UserLibraries) DEBUG PRINT
                    -(.\Out_File\SEEKFREE_IMU963RA.lst) TABS(2) OBJECT(.\Out_File\SEEKFREE_IMU963RA.obj) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2           * COPYRIGHT NOTICE
    3           * Copyright (c) 2018,Öð·É¿Æ¼¼
    4           * All rights reserved.
    5           * ¼¼ÊõÌÖÂÛQQÈº£ºÒ»Èº£º179029047(ÒÑÂú)  ¶þÈº£º244861897
    6           *
    7           * ÒÔÏÂËùÓÐÄÚÈÝ°æÈ¨¾ùÊôÖð·É¿Æ¼¼ËùÓÐ£¬Î´¾­ÔÊÐí²»µÃÓÃÓÚÉÌÒµÓÃÍ¾£¬
    8           * »¶Ó­¸÷Î»Ê¹ÓÃ²¢´«²¥±¾³ÌÐò£¬ÐÞ¸ÄÄÚÈÝÊ±±ØÐë±£ÁôÖð·É¿Æ¼¼µÄ°æÈ¨ÉùÃ÷¡£
    9           *
   10           * @file          IMU963RA
   11           * @company       ³É¶¼Öð·É¿Æ¼¼ÓÐÏÞ¹«Ë¾
   12           * @author        Öð·É¿Æ¼¼(QQ3184284598)
   13           * @version       ²é¿´docÄÚversionÎÄ¼þ °æ±¾ËµÃ÷
   14           * @Software    MDK FOR C251 V5.60
   15           * @Target core   STC32F12K
   16           * @Taobao      https://seekfree.taobao.com/
   17           * @date          2019-04-30
   18           * @note    
   19           * ½ÓÏß¶¨Òå£º
   20           *                   ------------------------------------
   21           *                   Ä£¿é¹Ü½Å            µ¥Æ¬»ú¹Ü½Å
   22           *                   // Ó²¼þ SPI Òý½Å
   23           *                   SCL/SPC             ²é¿´ SEEKFREE_IMU963RA.h ÖÐ IMU963RA_SPC_PIN ºê¶¨Òå
   24           *                   SDA/DSI             ²é¿´ SEEKFREE_IMU963RA.h ÖÐ IMU963RA_SDI_PIN ºê¶¨Òå
   25           *                   SA0/SDO             ²é¿´ SEEKFREE_IMU963RA.h ÖÐ IMU963RA_SDO_PIN ºê¶¨Òå
   26           *                   CS                  ²é¿´ SEEKFREE_IMU963RA.h ÖÐ IMU963RA_CS_PIN  ºê¶¨Òå
   27           *                   VCC                 3.3VµçÔ´
   28           *                   GND                 µçÔ´µØ
   29           *                   ÆäÓàÒý½ÅÐü¿Õ
   30           *
   31           *                   // Èí¼þ IIC Òý½Å
   32           *                   SCL/SPC             ²é¿´ SEEKFREE_IMU963RA.h ÖÐ IMU963RA_SCL_PIN ºê¶¨Òå
   33           *                   SDA/DSI             ²é¿´ SEEKFREE_IMU963RA.h ÖÐ IMU963RA_SDA_PIN ºê¶¨Òå
   34           *                   VCC                 3.3VµçÔ´
   35           *                   GND                 µçÔ´µØ
   36           *                   ÆäÓàÒý½ÅÐü¿Õ
   37           *                   ------------------------------------
   38          *********************************************************************************************************
             -***********/
   39          
   40          #include "SEEKFREE_IMU963RA.h"
   41          
   42          #include "zf_delay.h"
   43          #include "zf_spi.h"
   44          
   45          
   46          
   47          #pragma warning disable = 177
   48          #pragma warning disable = 183
   49          
   50          
   51          int16 imu963ra_gyro_x = 0, imu963ra_gyro_y = 0, imu963ra_gyro_z = 0;
   52          int16 imu963ra_acc_x = 0,  imu963ra_acc_y = 0,  imu963ra_acc_z = 0;
   53          int16 imu963ra_mag_x = 0,  imu963ra_mag_y = 0,  imu963ra_mag_z = 0;
   54          
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 2   

   55          #if IMU963RA_USE_SOFT_IIC
               
               
               #define GET_IMU963RA_SDA        IMU963RA_SDA_PIN
               #define IMU963RA_SDA_LOW()          IMU963RA_SDA_PIN = 0    //IO¿ÚÊä³öµÍµçÆ½
               #define IMU963RA_SDA_HIGH()         IMU963RA_SDA_PIN = 1    //IO¿ÚÊä³ö¸ßµçÆ½
               
               #define IMU963RA_SCL_LOW()          IMU963RA_SCL_PIN = 0    //IO¿ÚÊä³öµÍµçÆ½
               #define IMU963RA_SCL_HIGH()         IMU963RA_SCL_PIN = 1    //IO¿ÚÊä³ö¸ßµçÆ½
               
               #define ack 1      //Ö÷Ó¦´ð
               #define no_ack 0   //´ÓÓ¦´ð 
               
               //-------------------------------------------------------------------------------------------------------
             -------------
               //  @brief      Ä£ÄâIICÑÓÊ±
               //  @return     void            
               //  @since      v1.0
               //  Sample usage:       Èç¹ûIICÍ¨Ñ¶Ê§°Ü¿ÉÒÔ³¢ÊÔÔö¼ÓjµÄÖµ
               //-------------------------------------------------------------------------------------------------------
             -------------
               static void imu963ra_simiic_delay(void)
               {
                   uint16 j=IMU963RA_SOFT_IIC_DELAY;   
                 while(j--);
               }
               
               //ÄÚ²¿Ê¹ÓÃ£¬ÓÃ»§ÎÞÐèµ÷ÓÃ
               static void imu963ra_simiic_start(void)
               {
                 IMU963RA_SDA_HIGH();
                 IMU963RA_SCL_HIGH();
                 imu963ra_simiic_delay();
                 IMU963RA_SDA_LOW();
                 imu963ra_simiic_delay();
                 IMU963RA_SCL_LOW();
               }
               
               //ÄÚ²¿Ê¹ÓÃ£¬ÓÃ»§ÎÞÐèµ÷ÓÃ
               static void imu963ra_simiic_stop(void)
               {
                 IMU963RA_SDA_LOW();
                 IMU963RA_SCL_LOW();
                 imu963ra_simiic_delay();
                 IMU963RA_SCL_HIGH();
                 imu963ra_simiic_delay();
                 IMU963RA_SDA_HIGH();
                 imu963ra_simiic_delay();
               }
               
               //Ö÷Ó¦´ð(°üº¬ack:SDA=0ºÍno_ack:SDA=0)
               //ÄÚ²¿Ê¹ÓÃ£¬ÓÃ»§ÎÞÐèµ÷ÓÃ
               static void imu963ra_simiic_sendack(unsigned char ack_dat)
               {
                   IMU963RA_SCL_LOW();
                 imu963ra_simiic_delay();
                 if(ack_dat) IMU963RA_SDA_LOW();
                   else      IMU963RA_SDA_HIGH();
               
                   IMU963RA_SCL_HIGH();
                   imu963ra_simiic_delay();
                   IMU963RA_SCL_LOW();
                   imu963ra_simiic_delay();
               }
               
               
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 3   

               static int imu963ra_sccb_waitack(void)
               {
                   IMU963RA_SCL_LOW();
               
                 imu963ra_simiic_delay();
                 
                 IMU963RA_SCL_HIGH();
                   imu963ra_simiic_delay();
                 
                   if(GET_IMU963RA_SDA)           //Ó¦´ðÎª¸ßµçÆ½£¬Òì³££¬Í¨ÐÅÊ§°Ü
                   {
               
                       IMU963RA_SCL_LOW();
                       return 0;
                   }
               
                   IMU963RA_SCL_LOW();
                 imu963ra_simiic_delay();
                   return 1;
               }
               
               //×Ö½Ú·¢ËÍ³ÌÐò
               //·¢ËÍc(¿ÉÒÔÊÇÊý¾ÝÒ²¿ÉÊÇµØÖ·)£¬ËÍÍêºó½ÓÊÕ´ÓÓ¦´ð
               //²»¿¼ÂÇ´ÓÓ¦´ðÎ»
               //ÄÚ²¿Ê¹ÓÃ£¬ÓÃ»§ÎÞÐèµ÷ÓÃ
               static void imu963ra_send_ch(uint8 c)
               {
                 uint8 i = 8;
                   while(i--)
                   {
                       if(c & 0x80)  IMU963RA_SDA_HIGH();//SDA Êä³öÊý¾Ý
                       else      IMU963RA_SDA_LOW();
                       c <<= 1;
                       imu963ra_simiic_delay();
                       IMU963RA_SCL_HIGH();                //SCL À­¸ß£¬²É¼¯ÐÅºÅ
                       imu963ra_simiic_delay();
                       IMU963RA_SCL_LOW();                //SCL Ê±ÖÓÏßÀ­µÍ
                   }
                 imu963ra_sccb_waitack();
               }
               
               
               //×Ö½Ú½ÓÊÕ³ÌÐò
               //½ÓÊÕÆ÷¼þ´«À´µÄÊý¾Ý£¬´Ë³ÌÐòÓ¦ÅäºÏ|Ö÷Ó¦´ðº¯Êý|Ê¹ÓÃ
               //ÄÚ²¿Ê¹ÓÃ£¬ÓÃ»§ÎÞÐèµ÷ÓÃ
               static uint8 imu963ra_read_ch(uint8 ack_x)
               {
                   uint8 i;
                   uint8 c;
                   c=0;
                   IMU963RA_SCL_LOW();
                   imu963ra_simiic_delay();
                   IMU963RA_SDA_HIGH();             
               
                   for(i=0;i<8;i++)
                   {
                       imu963ra_simiic_delay();
                       IMU963RA_SCL_LOW();         //ÖÃÊ±ÖÓÏßÎªµÍ£¬×¼±¸½ÓÊÕÊý¾ÝÎ»
                       imu963ra_simiic_delay();
                       IMU963RA_SCL_HIGH();         //ÖÃÊ±ÖÓÏßÎª¸ß£¬Ê¹Êý¾ÝÏßÉÏÊý¾ÝÓÐÐ§
                       imu963ra_simiic_delay();
                       c<<=1;
                       if(GET_IMU963RA_SDA) 
                       {
                           c+=1;   //¶ÁÊý¾ÝÎ»£¬½«½ÓÊÕµÄÊý¾Ý´æc
                       }
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 4   

                   }
               
                 IMU963RA_SCL_LOW();
                 imu963ra_simiic_delay();
                 imu963ra_simiic_sendack(ack_x);
                 
                   return c;
               }
               
               
               //-------------------------------------------------------------------------------------------------------
             -------------
               //  @brief      Ä£ÄâIICÐ´Êý¾Ýµ½Éè±¸¼Ä´æÆ÷º¯Êý
               //  @param      dev_add     Éè±¸µØÖ·(µÍÆßÎ»µØÖ·)
               //  @param      reg       ¼Ä´æÆ÷µØÖ·
               //  @param      dat       Ð´ÈëµÄÊý¾Ý
               //  @return     void            
               //  @since      v1.0
               //  Sample usage:       
               //-------------------------------------------------------------------------------------------------------
             -------------
               static void imu963ra_simiic_write_reg(uint8 dev_add, uint8 reg, uint8 dat)
               {
                 imu963ra_simiic_start();
                   imu963ra_send_ch( (dev_add<<1) | 0x00);   //·¢ËÍÆ÷¼þµØÖ·¼ÓÐ´Î»
                 imu963ra_send_ch( reg );           //·¢ËÍ´Ó»ú¼Ä´æÆ÷µØÖ·
                 imu963ra_send_ch( dat );           //·¢ËÍÐèÒªÐ´ÈëµÄÊý¾Ý
                 imu963ra_simiic_stop();
               }
               
               
               
               
               //-------------------------------------------------------------------------------------------------------
             -------------
               //  @brief      Ä£ÄâIIC´ÓÉè±¸¼Ä´æÆ÷¶ÁÈ¡Êý¾Ý
               //  @param      dev_add     Éè±¸µØÖ·(µÍÆßÎ»µØÖ·)
               //  @param      reg       ¼Ä´æÆ÷µØÖ·
               //  @param      type      Ñ¡ÔñÍ¨ÐÅ·½Ê½ÊÇIIC  »¹ÊÇ SCCB
               //  @return     uint8     ·µ»Ø¼Ä´æÆ÷µÄÊý¾Ý      
               //  @since      v1.0
               //  Sample usage:       
               //-------------------------------------------------------------------------------------------------------
             -------------
               //static uint8 imu963ra_simiic_read_reg(uint8 dev_add, uint8 reg)
               //{
               //  uint8 dat;
               //  imu963ra_simiic_start();
               //    imu963ra_send_ch( (dev_add<<1) | 0x00);  //·¢ËÍÆ÷¼þµØÖ·¼ÓÐ´Î»
               //  imu963ra_send_ch( reg );          //·¢ËÍ´Ó»ú¼Ä´æÆ÷µØÖ·
               
               //  
               //  imu963ra_simiic_start();
               //  imu963ra_send_ch( (dev_add<<1) | 0x01);  //·¢ËÍÆ÷¼þµØÖ·¼Ó¶ÁÎ»
               //  dat = imu963ra_read_ch(no_ack);           //¶ÁÈ¡Êý¾Ý
               //  imu963ra_simiic_stop();
               //  
               //  return dat;
               //}
               
               
               //-------------------------------------------------------------------------------------------------------
             -------------
               //  @brief      Ä£ÄâIIC´ÓÉè±¸¼Ä´æÆ÷¶ÁÈ¡Êý¾Ý
               //  @param      dev_add     Éè±¸µØÖ·(µÍÆßÎ»µØÖ·)
               //  @param      reg       ¼Ä´æÆ÷µØÖ·
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 5   

               //  @return     uint8     ·µ»Ø¼Ä´æÆ÷µÄÊý¾Ý      
               //  @since      v1.0
               //  Sample usage:       
               //-------------------------------------------------------------------------------------------------------
             -------------
               static uint8 imu963ra_simiic_sccb_read_reg(uint8 dev_add, uint8 reg)
               {
                 uint8 dat;
                 imu963ra_simiic_start();
                   imu963ra_send_ch( (dev_add<<1) | 0x00);  //·¢ËÍÆ÷¼þµØÖ·¼ÓÐ´Î»
                 imu963ra_send_ch( reg );          //·¢ËÍ´Ó»ú¼Ä´æÆ÷µØÖ·
                 imu963ra_simiic_stop();
                 
                 imu963ra_simiic_start();
                 imu963ra_send_ch( (dev_add<<1) | 0x01);  //·¢ËÍÆ÷¼þµØÖ·¼Ó¶ÁÎ»
                 dat = imu963ra_read_ch(no_ack);           //¶ÁÈ¡Êý¾Ý
                 imu963ra_simiic_stop();
                 
                 return dat;
               }
               
               
               //-------------------------------------------------------------------------------------------------------
             -------------
               //  @brief      Ä£ÄâIIC¶ÁÈ¡¶à×Ö½ÚÊý¾Ý
               //  @param      dev_add     Éè±¸µØÖ·(µÍÆßÎ»µØÖ·)
               //  @param      reg       ¼Ä´æÆ÷µØÖ·
               //  @param      dat_add     Êý¾Ý±£´æµÄµØÖ·Ö¸Õë
               //  @param      num       ¶ÁÈ¡×Ö½ÚÊýÁ¿
               //  @param      type      Ñ¡ÔñÍ¨ÐÅ·½Ê½ÊÇIIC  »¹ÊÇ SCCB
               //  @return     uint8     ·µ»Ø¼Ä´æÆ÷µÄÊý¾Ý      
               //  @since      v1.0
               //  Sample usage:       
               //-------------------------------------------------------------------------------------------------------
             -------------
               static void imu963ra_simiic_read_regs(uint8 dev_add, uint8 reg, uint8 *dat_add, uint32 num)
               {
                 imu963ra_simiic_start();
                   imu963ra_send_ch( (dev_add<<1) | 0x00);  //·¢ËÍÆ÷¼þµØÖ·¼ÓÐ´Î»
                 imu963ra_send_ch( reg );          //·¢ËÍ´Ó»ú¼Ä´æÆ÷µØÖ·
               
                 
                 imu963ra_simiic_start();
                 imu963ra_send_ch( (dev_add<<1) | 0x01);  //·¢ËÍÆ÷¼þµØÖ·¼Ó¶ÁÎ»
                   while(--num)
                   {
                       *dat_add = imu963ra_read_ch(ack); //¶ÁÈ¡Êý¾Ý
                       dat_add++;
                   }
                   *dat_add = imu963ra_read_ch(no_ack); //¶ÁÈ¡Êý¾Ý
                 imu963ra_simiic_stop();
               }
               
               
               //-------------------------------------------------------------------------------------------------------
             -------------
               // º¯Êý¼ò½é     IMU963RA Ð´¼Ä´æÆ÷
               // ²ÎÊýËµÃ÷     reg             ¼Ä´æÆ÷µØÖ·
               // ²ÎÊýËµÃ÷     dat            Êý¾Ý
               // ·µ»Ø²ÎÊý     void
               // Ê¹ÓÃÊ¾Àý     imu963ra_write_acc_gyro_register(IMU963RA_SLV0_CONFIG, 0x00);
               // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
               //-------------------------------------------------------------------------------------------------------
             -------------
               #define imu963ra_write_acc_gyro_register(reg,dat)       (imu963ra_simiic_write_reg(IMU963RA_DEV_ADDR,reg,
             -dat))
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 6   

               
               //-------------------------------------------------------------------------------------------------------
             -------------
               // º¯Êý¼ò½é     IMU963RA ¶Á¼Ä´æÆ÷
               // ²ÎÊýËµÃ÷     reg             ¼Ä´æÆ÷µØÖ·
               // ·µ»Ø²ÎÊý     uint8           Êý¾Ý
               // Ê¹ÓÃÊ¾Àý     imu963ra_read_acc_gyro_register(IMU963RA_STATUS_MASTER);
               // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
               //-------------------------------------------------------------------------------------------------------
             -------------
               #define imu963ra_read_acc_gyro_register(reg)             (imu963ra_simiic_sccb_read_reg(IMU963RA_DEV_ADDR
             -,reg))
               
               //-------------------------------------------------------------------------------------------------------
             -------------
               // º¯Êý¼ò½é     IMU963RA ¶ÁÊý¾Ý ÄÚ²¿µ÷ÓÃ
               // ²ÎÊýËµÃ÷     reg             ¼Ä´æÆ÷µØÖ·
               // ²ÎÊýËµÃ÷     dat            Êý¾Ý»º³åÇø
               // ²ÎÊýËµÃ÷     len             Êý¾Ý³¤¶È
               // ·µ»Ø²ÎÊý     void
               // Ê¹ÓÃÊ¾Àý     imu963ra_read_acc_gyro_registers(IMU963RA_OUTX_L_A, dat, 6);
               // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
               //-------------------------------------------------------------------------------------------------------
             -------------
               #define imu963ra_read_acc_gyro_registers(reg,dat,len)   (imu963ra_simiic_read_regs(IMU963RA_DEV_ADDR,reg,
             -dat,len))
               
               
               #else
  329          
  330          
  331          
  332          #define IMU963RA_SCK(x)       IMU963RA_SPC_PIN  = x
  333          #define IMU963RA_MOSI(x)      IMU963RA_SDI_PIN = x
  334          #define IMU963RA_CS(x)        IMU963RA_CS_PIN  = x
  335          #define IMU963RA_MISO         IMU963RA_SDO_PIN 
  336          
  337          //-------------------------------------------------------------------------------------------------------
             -------------
  338          //  @brief      Í¨¹ýSPIÐ´Ò»¸öbyte,Í¬Ê±¶ÁÈ¡Ò»¸öbyte
  339          //  @param      byte        ·¢ËÍµÄÊý¾Ý    
  340          //  @return     uint8       return ·µ»Østatus×´Ì¬
  341          //  @since      v1.0
  342          //  Sample usage:
  343          //-------------------------------------------------------------------------------------------------------
             -------------
  344          static uint8 imu963ra_simspi_wr_byte(uint8 byte)
  345          {
  346   1          uint8 i;
  347   1        
  348   1          for(i=0; i<8; i++)
  349   1          {
  350   2              IMU963RA_MOSI(byte&0x80);
  351   2              byte <<= 1;
  352   2          IMU963RA_SCK (0);
  353   2          IMU963RA_SCK (0);
  354   2          
  355   2          IMU963RA_SCK (1);
  356   2          IMU963RA_SCK (1);
  357   2          byte |= IMU963RA_MISO; 
  358   2          } 
  359   1          return(byte);                                         
  360   1      }
  361          //-------------------------------------------------------------------------------------------------------
             -------------
  362          //  @brief      ½«valÐ´Èëcmd¶ÔÓ¦µÄ¼Ä´æÆ÷µØÖ·,Í¬Ê±·µ»Østatus×Ö½Ú
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 7   

  363          //  @param      cmd         ÃüÁî×Ö
  364          //  @param      val         ´ýÐ´Èë¼Ä´æÆ÷µÄÊýÖµ
  365          //  @since      v1.0
  366          //  Sample usage:
  367          //-------------------------------------------------------------------------------------------------------
             -------------
  368          static void imu963ra_simspi_w_reg_byte(uint8 cmd, uint8 val)
  369          {
  370   1          IMU963RA_CS(0);
  371   1          cmd |= IMU963RA_SPI_W;
  372   1          imu963ra_simspi_wr_byte(cmd);                       
  373   1          imu963ra_simspi_wr_byte(val);                                 
  374   1          IMU963RA_CS(1);                                     
  375   1      }
  376          
  377          
  378          //-------------------------------------------------------------------------------------------------------
             -------------
  379          //  @brief      ½«valÐ´Èëcmd¶ÔÓ¦µÄ¼Ä´æÆ÷µØÖ·
  380          //  @param      cmd         ÃüÁî×Ö
  381          //  @param      val         ´ýÐ´Èë¼Ä´æÆ÷µÄÊýÖµ
  382          //  @since      v1.0
  383          //  Sample usage:
  384          //-------------------------------------------------------------------------------------------------------
             -------------
  385          //static void imu963ra_simspi_w_reg_bytes(uint8 cmd, uint8 *dat_addr, uint32 len)
  386          //{
  387          
  388          //  
  389          //    IMU963RA_CS(0);
  390          //    cmd |= IMU963RA_SPI_W;
  391          //    imu963ra_simspi_wr_byte(cmd);   
  392          //  while(len--)
  393          //  {
  394          //    imu963ra_simspi_wr_byte(*dat_addr++); 
  395          //  }                 
  396          //    IMU963RA_CS(1);                                     
  397          //}
  398          
  399          //-------------------------------------------------------------------------------------------------------
             -------------
  400          //  @brief      ¶ÁÈ¡cmdËù¶ÔÓ¦µÄ¼Ä´æÆ÷µØÖ·
  401          //  @param      cmd         ÃüÁî×Ö
  402          //  @param      *val        ´æ´¢¶ÁÈ¡µÄÊý¾ÝµØÖ·
  403          //  @since      v1.0
  404          //  Sample usage:
  405          //-------------------------------------------------------------------------------------------------------
             -------------
  406          static void imu963ra_simspi_r_reg_byte(uint8 cmd, uint8 *val)
  407          {
  408   1          IMU963RA_CS(0);
  409   1          cmd |= IMU963RA_SPI_R;
  410   1          imu963ra_simspi_wr_byte(cmd);                                 
  411   1          *val = imu963ra_simspi_wr_byte(0);                            
  412   1          IMU963RA_CS(1);                                     
  413   1      }
  414          
  415          //-------------------------------------------------------------------------------------------------------
             -------------
  416          //  @brief      ¶ÁÈ¡cmdËù¶ÔÓ¦µÄ¼Ä´æÆ÷µØÖ·
  417          //  @param      cmd         ÃüÁî×Ö
  418          //  @param      *val        ´æ´¢¶ÁÈ¡µÄÊý¾ÝµØÖ·
  419          //  @param      num         ¶ÁÈ¡µÄÊýÁ¿
  420          //  @since      v1.0
  421          //  Sample usage:
  422          //-------------------------------------------------------------------------------------------------------
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 8   

             -------------
  423          static void imu963ra_simspi_r_reg_bytes(uint8 cmd, uint8 *val, uint32 num)
  424          {
  425   1      
  426   1          cmd |= IMU963RA_SPI_R;
  427   1          imu963ra_simspi_wr_byte(cmd);
  428   1      
  429   1        while(num--)
  430   1        {
  431   2          *val++ = imu963ra_simspi_wr_byte(0);
  432   2        }          
  433   1      }
  434          
  435          
  436          
  437          //-------------------------------------------------------------------------------------------------------
             -------------
  438          // º¯Êý¼ò½é     IMU963RA Ð´¼Ä´æÆ÷
  439          // ²ÎÊýËµÃ÷     reg             ¼Ä´æÆ÷µØÖ·
  440          // ²ÎÊýËµÃ÷     dat            Êý¾Ý
  441          // ·µ»Ø²ÎÊý     void
  442          // Ê¹ÓÃÊ¾Àý     imu963ra_write_acc_gyro_register(IMU963RA_SLV0_CONFIG, 0x00);
  443          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  444          //-------------------------------------------------------------------------------------------------------
             -------------
  445          static void imu963ra_write_acc_gyro_register(uint8 reg, uint8 dat)
  446          {
  447   1          IMU963RA_CS(0);
  448   1          imu963ra_simspi_w_reg_byte(reg | IMU963RA_SPI_W, dat);
  449   1      
  450   1          IMU963RA_CS(1);
  451   1      }
  452          
  453          //-------------------------------------------------------------------------------------------------------
             -------------
  454          // º¯Êý¼ò½é     IMU963RA ¶Á¼Ä´æÆ÷
  455          // ²ÎÊýËµÃ÷     reg             ¼Ä´æÆ÷µØÖ·
  456          // ·µ»Ø²ÎÊý     uint8           Êý¾Ý
  457          // Ê¹ÓÃÊ¾Àý     imu963ra_read_acc_gyro_register(IMU963RA_STATUS_MASTER);
  458          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  459          //-------------------------------------------------------------------------------------------------------
             -------------
  460          static uint8 imu963ra_read_acc_gyro_register(uint8 reg)
  461          {
  462   1          uint8 dat = 0;
  463   1          IMU963RA_CS(0);
  464   1        imu963ra_simspi_r_reg_byte(reg | IMU963RA_SPI_R , &dat);
  465   1          IMU963RA_CS(1);
  466   1          return dat;
  467   1      }
  468          
  469          //-------------------------------------------------------------------------------------------------------
             -------------
  470          // º¯Êý¼ò½é     IMU963RA ¶ÁÊý¾Ý ÄÚ²¿µ÷ÓÃ
  471          // ²ÎÊýËµÃ÷     reg             ¼Ä´æÆ÷µØÖ·
  472          // ²ÎÊýËµÃ÷     dat            Êý¾Ý»º³åÇø
  473          // ²ÎÊýËµÃ÷     len             Êý¾Ý³¤¶È
  474          // ·µ»Ø²ÎÊý     void
  475          // Ê¹ÓÃÊ¾Àý     imu963ra_read_acc_gyro_registers(IMU963RA_OUTX_L_A, dat, 6);
  476          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  477          //-------------------------------------------------------------------------------------------------------
             -------------
  478          static void imu963ra_read_acc_gyro_registers(uint8 reg, uint8 *dat, uint32 len)
  479          {
  480   1          IMU963RA_CS(0);
  481   1          imu963ra_simspi_r_reg_bytes( reg | IMU963RA_SPI_R, dat, len);
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 9   

  482   1      
  483   1          IMU963RA_CS(1);
  484   1      }
  485          #endif
  486          
  487          //-------------------------------------------------------------------------------------------------------
             -------------
  488          // º¯Êý¼ò½é     IMU963RA ×÷Îª IIC Ö÷»úÏò´ÅÁ¦¼ÆÐ´Êý¾Ý
  489          // ²ÎÊýËµÃ÷     addr            Ä¿±êµØÖ·
  490          // ²ÎÊýËµÃ÷     reg             Ä¿±ê¼Ä´æÆ÷
  491          // ²ÎÊýËµÃ÷     dat            Êý¾Ý
  492          // ·µ»Ø²ÎÊý     uint8           1-Ê§°Ü 0-³É¹¦
  493          // Ê¹ÓÃÊ¾Àý     imu963ra_write_mag_register(IMU963RA_MAG_ADDR, IMU963RA_MAG_CONTROL2, 0x80);
  494          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  495          //-------------------------------------------------------------------------------------------------------
             -------------
  496          static uint8 imu963ra_write_mag_register (uint8 addr, uint8 reg, uint8 dat)
  497          {
  498   1          uint8 return_state = 0;
  499   1          uint16 timeout_count = 0;
  500   1      
  501   1          addr = addr << 1;
  502   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_CONFIG, 0x00);               // ´Ó»ú0ÅäÖÃÇå³ý
  503   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_ADD, addr | 0);              // ÉèÖÃµØ´Å¼ÆµØÖ·£¨×¢ÒâÕâ
             -ÀïÐèÒªÉèÖÃ8Î»µÄI2CµØÖ·£© 0x2C
  504   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_SUBADD, reg);                // ÐèÒªÐ´ÈëµÄ¼Ä´æÆ÷µØÖ·
  505   1          imu963ra_write_acc_gyro_register(IMU963RA_DATAWRITE_SLV0, dat);            // ÐèÒªÐ´ÈëµÄÊý¾Ý
  506   1          imu963ra_write_acc_gyro_register(IMU963RA_MASTER_CONFIG, 0x4C);             // ½öÔÚµÚÒ»¸öÖÜÆÚÆôÓÃÍ¨Ñ¶
             - ¿ªÆôÉÏÀ­ I2CÖ÷»úÊ¹ÄÜ
  507   1          
  508   1          // µÈ´ýÍ¨Ñ¶³É¹¦
  509   1          while(0 == (0x80 & imu963ra_read_acc_gyro_register(IMU963RA_STATUS_MASTER)))
  510   1          {
  511   2              if(timeout_count ++ > IMU963RA_TIMEOUT_COUNT)
  512   2              {
  513   3                  return_state = 1;
  514   3                  break;
  515   3              }
  516   2              delay_ms(2);
  517   2          }
  518   1          return return_state;
  519   1      }
  520          
  521          //-------------------------------------------------------------------------------------------------------
             -------------
  522          // º¯Êý¼ò½é     IMU963RA ×÷Îª IIC Ö÷»úÏò´ÅÁ¦¼Æ¶ÁÊý¾Ý
  523          // ²ÎÊýËµÃ÷     addr            Ä¿±êµØÖ·
  524          // ²ÎÊýËµÃ÷     reg             Ä¿±ê¼Ä´æÆ÷
  525          // ·µ»Ø²ÎÊý     uint8           ¶ÁÈ¡µÄÊý¾Ý
  526          // Ê¹ÓÃÊ¾Àý     imu963ra_read_mag_register(IMU963RA_MAG_ADDR, IMU963RA_MAG_CHIP_ID);
  527          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  528          //-------------------------------------------------------------------------------------------------------
             -------------
  529          static uint8 imu963ra_read_mag_register (uint8 addr, uint8 reg)
  530          {
  531   1          uint16 timeout_count = 0;
  532   1      
  533   1          addr = addr << 1;
  534   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_ADD, addr | 1);              // ÉèÖÃµØ´Å¼ÆµØÖ·£¨×¢ÒâÕâ
             -ÀïÐèÒªÉèÖÃ8Î»µÄI2CµØÖ·£© 0x2C
  535   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_SUBADD, reg);                // ÐèÒª¶ÁÈ¡µÄ¼Ä´æÆ÷µØÖ·
  536   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_CONFIG, 0x01);    
  537   1          imu963ra_write_acc_gyro_register(IMU963RA_MASTER_CONFIG, 0x4C);             // ½öÔÚµÚÒ»¸öÖÜÆÚÆôÓÃÍ¨Ñ¶
             - ¿ªÆôÉÏÀ­ I2CÖ÷»úÊ¹ÄÜ
  538   1          
  539   1          // µÈ´ýÍ¨Ñ¶³É¹¦
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 10  

  540   1          while(0 == (0x01 & imu963ra_read_acc_gyro_register(IMU963RA_STATUS_MASTER)))
  541   1          {
  542   2              if(timeout_count ++ > IMU963RA_TIMEOUT_COUNT)
  543   2              {
  544   3                  break;
  545   3              }
  546   2              delay_ms(2);
  547   2          }
  548   1          
  549   1          return (imu963ra_read_acc_gyro_register(IMU963RA_SENSOR_HUB_1));            // ·µ»Ø¶ÁÈ¡µ½µÄÊý¾Ý
  550   1      }
  551          
  552          //-------------------------------------------------------------------------------------------------------
             -------------
  553          // º¯Êý¼ò½é     IMU963RA ×÷Îª IIC Ö÷»úÏò´ÅÁ¦¼Æ×Ô¶¯Ð´Êý¾Ý
  554          // ²ÎÊýËµÃ÷     addr            Ä¿±êµØÖ·
  555          // ²ÎÊýËµÃ÷     reg             Ä¿±ê¼Ä´æÆ÷
  556          // ·µ»Ø²ÎÊý     void
  557          // Ê¹ÓÃÊ¾Àý     imu963ra_connect_mag(IMU963RA_MAG_ADDR, IMU963RA_MAG_OUTX_L);
  558          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  559          //-------------------------------------------------------------------------------------------------------
             -------------
  560          static void imu963ra_connect_mag (uint8 addr, uint8 reg)
  561          {
  562   1          addr = addr << 1;
  563   1          
  564   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_ADD, addr | 1);              // ÉèÖÃµØ´Å¼ÆµØÖ·£¨×¢ÒâÕâ
             -ÀïÐèÒªÉèÖÃ8Î»µÄI2CµØÖ·£© 0x2C
  565   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_SUBADD, reg);                // ÐèÒª¶ÁÈ¡µÄ¼Ä´æÆ÷µØÖ·
  566   1          imu963ra_write_acc_gyro_register(IMU963RA_SLV0_CONFIG, 0x06);    
  567   1          imu963ra_write_acc_gyro_register(IMU963RA_MASTER_CONFIG, 0x6C);             // ½öÔÚµÚÒ»¸öÖÜÆÚÆôÓÃÍ¨Ñ¶
             - ¿ªÆôÉÏÀ­ I2CÖ÷»úÊ¹ÄÜ
  568   1      }   
  569          
  570          
  571          //-------------------------------------------------------------------------------------------------------
             -------------
  572          // º¯Êý¼ò½é     IMU963RA ÁùÖá×Ô¼ì ÄÚ²¿µ÷ÓÃ
  573          // ²ÎÊýËµÃ÷     void
  574          // ·µ»Ø²ÎÊý     uint8           1-×Ô¼ìÊ§°Ü 0-×Ô¼ì³É¹¦
  575          // Ê¹ÓÃÊ¾Àý     imu963ra_acc_gyro_self_check();
  576          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  577          //-------------------------------------------------------------------------------------------------------
             -------------
  578          static uint8 imu963ra_acc_gyro_self_check (void)
  579          {
  580   1          uint8 return_state = 0;
  581   1          uint8 dat = 0;
  582   1          uint16 timeout_count = 0;
  583   1      
  584   1          while(0x6B != dat)                                                          // ÅÐ¶Ï ID ÊÇ·ñÕýÈ·
  585   1          {
  586   2              if(timeout_count++ > IMU963RA_TIMEOUT_COUNT)
  587   2              {
  588   3                  return_state = 1;
  589   3                  break;
  590   3              }
  591   2              dat = imu963ra_read_acc_gyro_register(IMU963RA_WHO_AM_I);
  592   2              delay_ms(10);
  593   2          }
  594   1          return return_state;
  595   1      }
  596          
  597          //-------------------------------------------------------------------------------------------------------
             -------------
  598          // º¯Êý¼ò½é     IMU963RA ´ÅÁ¦¼Æ×Ô¼ì ÄÚ²¿µ÷ÓÃ
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 11  

  599          // ²ÎÊýËµÃ÷     void
  600          // ·µ»Ø²ÎÊý     uint8           1-×Ô¼ìÊ§°Ü 0-×Ô¼ì³É¹¦
  601          // Ê¹ÓÃÊ¾Àý     imu963ra_mag_self_check();
  602          // ±¸×¢ÐÅÏ¢     ÄÚ²¿µ÷ÓÃ
  603          //-------------------------------------------------------------------------------------------------------
             -------------
  604          static uint8 imu963ra_mag_self_check (void)
  605          {
  606   1          uint8 return_state = 0;
  607   1          uint8 dat = 0;
  608   1          uint16 timeout_count = 0;
  609   1      
  610   1          while(0xff != dat)                                                          // ÅÐ¶Ï ID ÊÇ·ñÕýÈ·
  611   1          {
  612   2              if(timeout_count++ > IMU963RA_TIMEOUT_COUNT)
  613   2              {
  614   3                  return_state = 1;
  615   3                  break;
  616   3              }
  617   2              dat = imu963ra_read_mag_register(IMU963RA_MAG_ADDR, IMU963RA_MAG_CHIP_ID);
  618   2              delay_ms(10);
  619   2          }
  620   1          return return_state;
  621   1      }
  622          
  623          //-------------------------------------------------------------------------------------------------------
             -------------
  624          // º¯Êý¼ò½é     »ñÈ¡ IMU963RA ¼ÓËÙ¶È¼ÆÊý¾Ý
  625          // ²ÎÊýËµÃ÷     void
  626          // ·µ»Ø²ÎÊý     void
  627          // Ê¹ÓÃÊ¾Àý     imu963ra_get_acc();
  628          // ±¸×¢ÐÅÏ¢     Ö´ÐÐ¸Ãº¯Êýºó£¬Ö±½Ó²é¿´¶ÔÓ¦µÄ±äÁ¿¼´¿É
  629          //-------------------------------------------------------------------------------------------------------
             -------------
  630          void imu963ra_get_acc (void)
  631          {
  632   1          uint8 dat[6];
  633   1      
  634   1          imu963ra_read_acc_gyro_registers(IMU963RA_OUTX_L_A, dat, 6);
  635   1          imu963ra_acc_x = (int16)(((uint16)dat[1]<<8 | dat[0]));
  636   1          imu963ra_acc_y = (int16)(((uint16)dat[3]<<8 | dat[2]));
  637   1          imu963ra_acc_z = (int16)(((uint16)dat[5]<<8 | dat[4]));
  638   1      }
  639          
  640          
  641          //-------------------------------------------------------------------------------------------------------
             -------------
  642          // º¯Êý¼ò½é     »ñÈ¡IMU963RAÍÓÂÝÒÇÊý¾Ý
  643          // ²ÎÊýËµÃ÷     void
  644          // ·µ»Ø²ÎÊý     void
  645          // Ê¹ÓÃÊ¾Àý     imu963ra_get_gyro();
  646          // ±¸×¢ÐÅÏ¢     Ö´ÐÐ¸Ãº¯Êýºó£¬Ö±½Ó²é¿´¶ÔÓ¦µÄ±äÁ¿¼´¿É
  647          //-------------------------------------------------------------------------------------------------------
             -------------
  648          void imu963ra_get_gyro (void)
  649          {
  650   1          uint8 dat[6];
  651   1      
  652   1          imu963ra_read_acc_gyro_registers(IMU963RA_OUTX_L_G, dat, 6);
  653   1          imu963ra_gyro_x = (int16)(((uint16)dat[1]<<8 | dat[0]));
  654   1          imu963ra_gyro_y = (int16)(((uint16)dat[3]<<8 | dat[2]));
  655   1          imu963ra_gyro_z = (int16)(((uint16)dat[5]<<8 | dat[4]));
  656   1      }
  657          
  658          
  659          //-------------------------------------------------------------------------------------------------------
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 12  

             -------------
  660          // º¯Êý¼ò½é     »ñÈ¡ IMU963RA ´ÅÁ¦¼ÆÊý¾Ý
  661          // ²ÎÊýËµÃ÷     void
  662          // ·µ»Ø²ÎÊý     void
  663          // Ê¹ÓÃÊ¾Àý     imu963ra_get_mag();
  664          // ±¸×¢ÐÅÏ¢     Ö´ÐÐ¸Ãº¯Êýºó£¬Ö±½Ó²é¿´¶ÔÓ¦µÄ±äÁ¿¼´¿É
  665          //-------------------------------------------------------------------------------------------------------
             -------------
  666          void imu963ra_get_mag (void)
  667          {
  668   1          uint8 temp_status;
  669   1          uint8 dat[6];
  670   1      
  671   1          imu963ra_write_acc_gyro_register(IMU963RA_FUNC_CFG_ACCESS, 0x40);
  672   1          temp_status = imu963ra_read_acc_gyro_register(IMU963RA_STATUS_MASTER);
  673   1          if(0x01 & temp_status)
  674   1          {
  675   2              imu963ra_read_acc_gyro_registers(IMU963RA_SENSOR_HUB_1, dat, 6);
  676   2              imu963ra_mag_x = (int16)(((uint16)dat[1]<<8 | dat[0]));
  677   2              imu963ra_mag_y = (int16)(((uint16)dat[3]<<8 | dat[2]));
  678   2              imu963ra_mag_z = (int16)(((uint16)dat[5]<<8 | dat[4]));
  679   2          }
  680   1          imu963ra_write_acc_gyro_register(IMU963RA_FUNC_CFG_ACCESS, 0x00);
  681   1      }
  682          
  683          //-------------------------------------------------------------------------------------------------------
             -------------
  684          // º¯Êý¼ò½é     ½« IMU963RA ¼ÓËÙ¶È¼ÆÊý¾Ý×ª»»ÎªÊµ¼ÊÎïÀíÊý¾Ý
  685          // ²ÎÊýËµÃ÷     gyro_value      ÈÎÒâÖáµÄ¼ÓËÙ¶È¼ÆÊý¾Ý
  686          // ·µ»Ø²ÎÊý     void
  687          // Ê¹ÓÃÊ¾Àý     float dat = imu963ra_acc_transition(imu963ra_acc_x);           // µ¥Î»Îª g(m/s^2)
  688          // ±¸×¢ÐÅÏ¢
  689          //-------------------------------------------------------------------------------------------------------
             -------------
  690          float imu963ra_acc_transition (int16 acc_value)
  691          {
  692   1          float acc_dat = 0;
  693   1          switch(IMU963RA_ACC_SAMPLE)
  694   1          {
  695   2              case 0x30: acc_dat = (float)acc_value / 16393; break;                  // 0x30 ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À2G 
             -     »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ 16393 £¬¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»£ºg(m/s^2)
  696   2              case 0x38: acc_dat = (float)acc_value / 8197;  break;                  // 0x38 ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À4G 
             -     »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ 8197 £¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»£ºg(m/s^2)
  697   2              case 0x3C: acc_dat = (float)acc_value / 4098;  break;                  // 0x3C ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À8G 
             -     »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ 4098 £¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»£ºg(m/s^2)
  698   2              case 0x34: acc_dat = (float)acc_value / 2049;  break;                  // 0x34 ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À16G
             -     »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ 2049 £¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»£ºg(m/s^2)
  699   2              default: break;
  700   2          }
  701   1          return acc_dat;
  702   1      }
  703          
  704          //-------------------------------------------------------------------------------------------------------
             -------------
  705          // º¯Êý¼ò½é     ½« IMU963RA ÍÓÂÝÒÇÊý¾Ý×ª»»ÎªÊµ¼ÊÎïÀíÊý¾Ý
  706          // ²ÎÊýËµÃ÷     gyro_value      ÈÎÒâÖáµÄÍÓÂÝÒÇÊý¾Ý
  707          // ·µ»Ø²ÎÊý     void
  708          // Ê¹ÓÃÊ¾Àý     float dat = imu963ra_gyro_transition(imu963ra_gyro_x);         // µ¥Î»Îª¡ã/s
  709          // ±¸×¢ÐÅÏ¢
  710          //-------------------------------------------------------------------------------------------------------
             -------------
  711          float imu963ra_gyro_transition (int16 gyro_value)
  712          {
  713   1          float gyro_dat = 0;
  714   1          switch(IMU963RA_GYR_SAMPLE)
  715   1          {
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 13  

  716   2              case 0x52: gyro_dat = (float)gyro_value / 228.6f;  break;              //  0x52 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À12
             -5dps  »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ 228.6£¬   ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»Îª£º¡ã/s
  717   2              case 0x50: gyro_dat = (float)gyro_value / 114.3f;  break;              //  0x50 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À25
             -0dps  »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ 114.3£¬   ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»Îª£º¡ã/s
  718   2              case 0x54: gyro_dat = (float)gyro_value / 57.1f;   break;              //  0x54 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À50
             -0dps  »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ 57.1£¬    ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»Îª£º¡ã/s
  719   2              case 0x58: gyro_dat = (float)gyro_value / 28.6f;   break;              //  0x58 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À10
             -00dps »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ 28.6£¬    ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»Îª£º¡ã/s
  720   2              case 0x5C: gyro_dat = (float)gyro_value / 14.3f;   break;              //  0x5C ÍÓÂÝÒÇÁ¿³ÌÎª:¡À20
             -00dps »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ 14.3£¬    ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»Îª£º¡ã/s
  721   2              case 0x51: gyro_dat = (float)gyro_value / 7.1f;    break;              //  0x51 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À40
             -00dps »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ 7.1£¬     ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»Îª£º¡ã/s
  722   2              default: break;
  723   2          }
  724   1          return gyro_dat;
  725   1      }
  726          
  727          //-------------------------------------------------------------------------------------------------------
             -------------
  728          // º¯Êý¼ò½é     ½« IMU963RA µØ´Å¼ÆÊý¾Ý×ª»»ÎªÊµ¼ÊÎïÀíÊý¾Ý
  729          // ²ÎÊýËµÃ÷     mag_value       ÈÎÒâÖáµÄµØ´Å¼ÆÊý¾Ý
  730          // ·µ»Ø²ÎÊý     void
  731          // Ê¹ÓÃÊ¾Àý     float dat = imu963ra_mag_transition(imu963ra_mag_x);          // µ¥Î»ÎªG(¸ßË¹)
  732          // ±¸×¢ÐÅÏ¢
  733          //-------------------------------------------------------------------------------------------------------
             -------------
  734          float imu963ra_mag_transition (int16 mag_value)
  735          {
  736   1          float mag_dat = 0;
  737   1          switch(IMU963RA_MAG_SAMPLE)
  738   1          {
  739   2              case 0x19: mag_dat = (float)mag_value / 3000;  break;                  //  0x19 ´ÅÁ¦¼ÆÁ¿³ÌÎª:8G  
             -   »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ3000£¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»£ºG(¸ßË¹)
  740   2              case 0x09: mag_dat = (float)mag_value / 12000; break;                  //  0x09 ´ÅÁ¦¼ÆÁ¿³ÌÎª:2G  
             -   »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ12000£¬¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥Î»£ºG(¸ßË¹)
  741   2              default: break;
  742   2          }
  743   1          return mag_dat;
  744   1      }
  745          
  746          //-------------------------------------------------------------------------------------------------------
             -------------
  747          // º¯Êý¼ò½é     ³õÊ¼»¯ IMU963RA
  748          // ²ÎÊýËµÃ÷     void
  749          // ·µ»Ø²ÎÊý     uint8           1-³õÊ¼»¯Ê§°Ü 0-³õÊ¼»¯³É¹¦
  750          // Ê¹ÓÃÊ¾Àý     imu963ra_init();
  751          // ±¸×¢ÐÅÏ¢     
  752          //-------------------------------------------------------------------------------------------------------
             -------------
  753          uint8 imu963ra_init (void)
  754          {
  755   1          uint8 return_state = 0;
  756   1          delay_ms(10);                                                        // ÉÏµçÑÓÊ±
  757   1      
  758   1      //#if IMU963RA_USE_SOFT_IIC
  759   1      //    soft_iic_init(&imu963ra_iic_struct, IMU963RA_DEV_ADDR, IMU963RA_SOFT_IIC_DELAY, IMU963RA_SCL_PIN, I
             -MU963RA_SDA_PIN);
  760   1      //#else
  761   1      //    spi_init(IMU963RA_SPI, SPI_MODE0, IMU963RA_SPI_SPEED, IMU963RA_SPC_PIN, IMU963RA_SDI_PIN, IMU963RA_
             -SDO_PIN, SPI_CS_NULL);
  762   1      //    gpio_init(IMU963RA_CS_PIN, GPO, GPIO_LOW, GPO_PUSH_PULL);
  763   1      //#endif
  764   1      
  765   1          do
  766   1          {
  767   2              imu963ra_write_acc_gyro_register(IMU963RA_FUNC_CFG_ACCESS, 0x00);       // ¹Ø±ÕHUB¼Ä´æÆ÷·ÃÎÊ
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 14  

  768   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL3_C, 0x01);               // ¸´Î»Éè±¸
  769   2              delay_ms(2);                             
  770   2              imu963ra_write_acc_gyro_register(IMU963RA_FUNC_CFG_ACCESS, 0x00);       // ¹Ø±ÕHUB¼Ä´æÆ÷·ÃÎÊ
  771   2              if(imu963ra_acc_gyro_self_check())                   
  772   2              {                
  773   3      //      while(1)
  774   3      //      {
  775   3              printf( "IMU963RA acc and gyro self check error.\r\n");                    
  776   3      //        delay_ms(200);
  777   3      //      };
  778   3            
  779   3                  
  780   3                  return_state = 1;
  781   3                  break;            
  782   3              }                   
  783   2                                  
  784   2              imu963ra_write_acc_gyro_register(IMU963RA_INT1_CTRL, 0x03);             // ¿ªÆôÍÓÂÝÒÇ ¼ÓËÙ¶ÈÊý¾Ý¾
             -ÍÐ÷ÖÐ¶Ï
  785   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL1_XL, IMU963RA_GYR_SAMPLE);   // ÉèÖÃ¼ÓËÙ¶È¼ÆÁ¿³Ì ¡
             -À8G ÒÔ¼°Êý¾ÝÊä³öËÙÂÊ 52hz ÒÔ¼°¼ÓËÙ¶ÈÐÅÏ¢´ÓµÚÒ»¼¶ÂË²¨Æ÷Êä³ö
  786   2              // IMU963RA_CTRL1_XL ¼Ä´æÆ÷
  787   2              // ÉèÖÃÎª:0x30 ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À2G      »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ16393£¬¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»£ºg(m/s^2)
  788   2              // ÉèÖÃÎª:0x38 ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À4G      »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ8197£¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»£ºg(m/s^2)
  789   2              // ÉèÖÃÎª:0x3C ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À8G      »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ4098£¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»£ºg(m/s^2)
  790   2              // ÉèÖÃÎª:0x34 ¼ÓËÙ¶ÈÁ¿³ÌÎª:¡À16G     »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ2049£¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»£ºg(m/s^2)
  791   2              
  792   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL2_G, IMU963RA_ACC_SAMPLE);    // ÉèÖÃÍÓÂÝÒÇ¼ÆÁ¿³Ì ¡
             -À2000dps ÒÔ¼°Êý¾ÝÊä³öËÙÂÊ 208hz
  793   2              // IMU963RA_CTRL2_G ¼Ä´æÆ÷
  794   2              // ÉèÖÃÎª:0x52 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À125dps  »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ228.6£¬   ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»Îª£º¡ã/s
  795   2              // ÉèÖÃÎª:0x50 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À250dps  »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ114.3£¬   ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»Îª£º¡ã/s
  796   2              // ÉèÖÃÎª:0x54 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À500dps  »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ57.1£¬    ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»Îª£º¡ã/s
  797   2              // ÉèÖÃÎª:0x58 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À1000dps »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ28.6£¬    ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»Îª£º¡ã/s
  798   2              // ÉèÖÃÎª:0x5C ÍÓÂÝÒÇÁ¿³ÌÎª:¡À2000dps »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ14.3£¬    ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»Îª£º¡ã/s
  799   2              // ÉèÖÃÎª:0x51 ÍÓÂÝÒÇÁ¿³ÌÎª:¡À4000dps »ñÈ¡µ½µÄÍÓÂÝÒÇÊý¾Ý³ýÒÔ7.1£¬     ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£
             -¬µ¥Î»Îª£º¡ã/s
  800   2              
  801   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL3_C, 0x44);               // Ê¹ÄÜÍÓÂÝÒÇÊý×ÖµÍÍ¨ÂË²¨
             -Æ÷
  802   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL4_C, 0x02);               // Ê¹ÄÜÊý×ÖµÍÍ¨ÂË²¨Æ÷
  803   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL5_C, 0x00);               // ¼ÓËÙ¶È¼ÆÓëÍÓÂÝÒÇËÄÉáÎå
             -Èë
  804   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL6_C, 0x00);               // ¿ªÆô¼ÓËÙ¶È¼Æ¸ßÐÔÄÜÄ£Ê½
             - ÍÓÂÝÒÇµÍÍ¨ÂË²¨ 133hz
  805   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL7_G, 0x00);               // ¿ªÆôÍÓÂÝÒÇ¸ßÐÔÄÜÄ£Ê½ ¹
             -Ø±Õ¸ßÍ¨ÂË²¨
  806   2              imu963ra_write_acc_gyro_register(IMU963RA_CTRL9_XL, 0x01);              // ¹Ø±ÕI3C½Ó¿Ú
  807   2      
  808   2              imu963ra_write_acc_gyro_register(IMU963RA_FUNC_CFG_ACCESS, 0x40);       // ¿ªÆôHUB¼Ä´æÆ÷·ÃÎÊ ÓÃÓÚ
             -ÅäÖÃµØ´Å¼Æ
  809   2              imu963ra_write_acc_gyro_register(IMU963RA_MASTER_CONFIG, 0x80);         // ¸´Î»I2CÖ÷»ú
  810   2              delay_ms(2);                             
  811   2              imu963ra_write_acc_gyro_register(IMU963RA_MASTER_CONFIG, 0x00);         // Çå³ý¸´Î»±êÖ¾
  812   2              delay_ms(2);
  813   2              
  814   2              imu963ra_write_mag_register(IMU963RA_MAG_ADDR, IMU963RA_MAG_CONTROL2, 0x80);// ¸´Î»Á¬½ÓµÄÍâÉè
  815   2              delay_ms(2);
C251 COMPILER V5.60.0,  SEEKFREE_IMU963RA                                                  05/11/24  20:15:39  PAGE 15  

  816   2              imu963ra_write_mag_register(IMU963RA_MAG_ADDR, IMU963RA_MAG_CONTROL2, 0x00);
  817   2              delay_ms(2);
  818   2              
  819   2              
  820   2              if(imu963ra_mag_self_check())
  821   2              {
  822   3      //      while(1)
  823   3      //      {
  824   3              printf("IMU963RA mag self check error.\r\n");
  825   3      //        delay_ms(200);
  826   3      //      };
  827   3            
  828   3                  
  829   3                  return_state = 1;
  830   3                  break;            
  831   3              }
  832   2      
  833   2              imu963ra_write_mag_register(IMU963RA_MAG_ADDR, IMU963RA_MAG_CONTROL1, IMU963RA_MAG_SAMPLE); // Éè
             -ÖÃ´ÅÁ¦¼ÆÁ¿³Ì8G Êä³öËÙÂÊ100hz Á¬ÐøÄ£Ê½
  834   2              // IMU963RA_MAG_ADDR ¼Ä´æÆ÷
  835   2              // ÉèÖÃÎª:0x19 ´ÅÁ¦¼ÆÁ¿³ÌÎª:8G     »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ3000£¬ ¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥
             -Î»£ºG(¸ßË¹)
  836   2              // ÉèÖÃÎª:0x09 ´ÅÁ¦¼ÆÁ¿³ÌÎª:2G     »ñÈ¡µ½µÄ¼ÓËÙ¶È¼ÆÊý¾Ý ³ýÒÔ12000£¬¿ÉÒÔ×ª»¯Îª´øÎïÀíµ¥Î»µÄÊý¾Ý£¬µ¥
             -Î»£ºG(¸ßË¹)
  837   2              
  838   2              imu963ra_write_mag_register(IMU963RA_MAG_ADDR, IMU963RA_MAG_FBR, 0x01);
  839   2              imu963ra_connect_mag(IMU963RA_MAG_ADDR, IMU963RA_MAG_OUTX_L);
  840   2              
  841   2              imu963ra_write_acc_gyro_register(IMU963RA_FUNC_CFG_ACCESS, 0x00);       // ¹Ø±ÕHUB¼Ä´æÆ÷·ÃÎÊ
  842   2      
  843   2              delay_ms(20);                                                    // µÈ´ý´ÅÁ¦¼Æ»ñÈ¡Êý¾Ý
  844   2          }while(0);
  845   1          return return_state;
  846   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      1777     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       107     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       129     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
